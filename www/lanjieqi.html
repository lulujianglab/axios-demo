<!DOCTYPE html>
<html>
  <head>
    <title>拦截器</title>

    <style>
      .cssload-thecube {
        width: 73px;
        height: 73px;
        margin: 0 auto;
        margin-top: 49px;
        position: relative;
        transform: rotateZ(45deg);
          -o-transform: rotateZ(45deg);
          -ms-transform: rotateZ(45deg);
          -webkit-transform: rotateZ(45deg);
          -moz-transform: rotateZ(45deg);
      }
      .cssload-thecube .cssload-cube {
        position: relative;
        transform: rotateZ(45deg);
          -o-transform: rotateZ(45deg);
          -ms-transform: rotateZ(45deg);
          -webkit-transform: rotateZ(45deg);
          -moz-transform: rotateZ(45deg);
      }
      .cssload-thecube .cssload-cube {
        float: left;
        width: 50%;
        height: 50%;
        position: relative;
        transform: scale(1.1);
          -o-transform: scale(1.1);
          -ms-transform: scale(1.1);
          -webkit-transform: scale(1.1);
          -moz-transform: scale(1.1);
      }
      .cssload-thecube .cssload-cube:before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgb(43,160,199);
        animation: cssload-fold-thecube 2.76s infinite linear both;
          -o-animation: cssload-fold-thecube 2.76s infinite linear both;
          -ms-animation: cssload-fold-thecube 2.76s infinite linear both;
          -webkit-animation: cssload-fold-thecube 2.76s infinite linear both;
          -moz-animation: cssload-fold-thecube 2.76s infinite linear both;
        transform-origin: 100% 100%;
          -o-transform-origin: 100% 100%;
          -ms-transform-origin: 100% 100%;
          -webkit-transform-origin: 100% 100%;
          -moz-transform-origin: 100% 100%;
      }
      .cssload-thecube .cssload-c2 {
        transform: scale(1.1) rotateZ(90deg);
          -o-transform: scale(1.1) rotateZ(90deg);
          -ms-transform: scale(1.1) rotateZ(90deg);
          -webkit-transform: scale(1.1) rotateZ(90deg);
          -moz-transform: scale(1.1) rotateZ(90deg);
      }
      .cssload-thecube .cssload-c3 {
        transform: scale(1.1) rotateZ(180deg);
          -o-transform: scale(1.1) rotateZ(180deg);
          -ms-transform: scale(1.1) rotateZ(180deg);
          -webkit-transform: scale(1.1) rotateZ(180deg);
          -moz-transform: scale(1.1) rotateZ(180deg);
      }
      .cssload-thecube .cssload-c4 {
        transform: scale(1.1) rotateZ(270deg);
          -o-transform: scale(1.1) rotateZ(270deg);
          -ms-transform: scale(1.1) rotateZ(270deg);
          -webkit-transform: scale(1.1) rotateZ(270deg);
          -moz-transform: scale(1.1) rotateZ(270deg);
      }
      .cssload-thecube .cssload-c2:before {
        animation-delay: 0.35s;
          -o-animation-delay: 0.35s;
          -ms-animation-delay: 0.35s;
          -webkit-animation-delay: 0.35s;
          -moz-animation-delay: 0.35s;
      }
      .cssload-thecube .cssload-c3:before {
        animation-delay: 0.69s;
          -o-animation-delay: 0.69s;
          -ms-animation-delay: 0.69s;
          -webkit-animation-delay: 0.69s;
          -moz-animation-delay: 0.69s;
      }
      .cssload-thecube .cssload-c4:before {
        animation-delay: 1.04s;
          -o-animation-delay: 1.04s;
          -ms-animation-delay: 1.04s;
          -webkit-animation-delay: 1.04s;
          -moz-animation-delay: 1.04s;
      }



      @keyframes cssload-fold-thecube {
        0%, 10% {
          transform: perspective(136px) rotateX(-180deg);
          opacity: 0;
        }
        25%,
              75% {
          transform: perspective(136px) rotateX(0deg);
          opacity: 1;
        }
        90%,
              100% {
          transform: perspective(136px) rotateY(180deg);
          opacity: 0;
        }
      }

      @-o-keyframes cssload-fold-thecube {
        0%, 10% {
          -o-transform: perspective(136px) rotateX(-180deg);
          opacity: 0;
        }
        25%,
              75% {
          -o-transform: perspective(136px) rotateX(0deg);
          opacity: 1;
        }
        90%,
              100% {
          -o-transform: perspective(136px) rotateY(180deg);
          opacity: 0;
        }
      }

      @-ms-keyframes cssload-fold-thecube {
        0%, 10% {
          -ms-transform: perspective(136px) rotateX(-180deg);
          opacity: 0;
        }
        25%,
              75% {
          -ms-transform: perspective(136px) rotateX(0deg);
          opacity: 1;
        }
        90%,
              100% {
          -ms-transform: perspective(136px) rotateY(180deg);
          opacity: 0;
        }
      }

      @-webkit-keyframes cssload-fold-thecube {
        0%, 10% {
          -webkit-transform: perspective(136px) rotateX(-180deg);
          opacity: 0;
        }
        25%,
              75% {
          -webkit-transform: perspective(136px) rotateX(0deg);
          opacity: 1;
        }
        90%,
              100% {
          -webkit-transform: perspective(136px) rotateY(180deg);
          opacity: 0;
        }
      }

      @-moz-keyframes cssload-fold-thecube {
        0%, 10% {
          -moz-transform: perspective(136px) rotateX(-180deg);
          opacity: 0;
        }
        25%,
              75% {
          -moz-transform: perspective(136px) rotateX(0deg);
          opacity: 1;
        }
        90%,
              100% {
          -moz-transform: perspective(136px) rotateY(180deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>

    <div id="app"></div>

    <script src="https://cdn.bootcss.com/vue/2.6.4/vue.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.js"></script>

    <script type="text/javascript" >

      var App = {
        template: `<div>
            <div class="cssload-thecube" v-show="isshow">
              <div class="cssload-cube cssload-c1"></div>
              <div class="cssload-cube cssload-c2"></div>
              <div class="cssload-cube cssload-c4"></div>
              <div class="cssload-cube cssload-c3"></div>
            </div>
          response : {{res}}
          <hr />
          <button @click="sendAjax">sendReq</button>
        </div>`,
        data() {
          return {
            res: '',
            isshow: false // loading默认不出现
          }
        },
        methods: {
          // 实现一个类似cookie的机制
          // 服务器 =》 set-cookie:xxx 保存起来在响应拦截器中完成
          // 在请求之前，从本地获取xxx 设置拦截器，请求头
          sendAjax() {
            // 配置请求拦截器  use给请求之前做的事可以是多件，可以use多次
            axios.interceptors.request.use((config) => {
              // 在发送请求之前做些什么
              console.log(config)

              // 设置请求头，类似cookie
              var token = localStorage.getItem('token')
              if(token) {
                config.headers['token'] = token
              }

              this.isshow = true // loading 出现
              return config
            }, (error) => {
              return Promise.reject(error)
            })

            // 响应拦截器
            axios.interceptors.response.use((res) => {
              // 对响应数据做点什么
              console.log(res) // res.config
              console.log(111,res)
              // 获取服务器的响应头
              if(res.headers.token) {
                var token = res.headers.token
                localStorage.setItem('token',token)
              }
              
              this.isshow = false // loading 消失
              return res
            }, (error) => {
              return Promise.reject(error)
            })

            // 1. 在请求发起之前，show一个loading出来
            // 2. 响应回来之后，关闭这个loading

            axios.post('/token')
            .then(res => {
              console.log('响应回来了',res.data)
              this.res = res.data.msg
            })
            .catch(err => {
              console.log(err)
            })
          }
        }
      }

      Vue.prototype.$axios = axios

      new Vue({
        el: '#app',
        components: {
          app: App
        },       
        template: '<app/>' // 入口组件
      })
    </script>
  </body>
</html>